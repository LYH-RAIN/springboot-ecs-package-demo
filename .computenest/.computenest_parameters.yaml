{"ServicePort":"80","SecurityPorts":[80],"RepoName":"LYH-RAIN/springboot-ecs-package-demo","Arch":"EcsSingle","RunCommand":"#!/bin/bash\n# Check the operating system\n  # CentOS / Red Hat\nsudo yum install -y java-1.8.0-openjdk\necho y | sudo yum install java-1.8.0-openjdk-devel\n\necho 'export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk' >> ~/.bashrc\n\necho 'export PATH=$JAVA_HOME/bin:$PATH' >> ~/.bashrc\nsource ~/.bashrc\n\n# Verify Java installation\njava -version\n\n  # 安装 Maven\n  if [[ \"$OSTYPE\" == \"linux-gnu\"* ]]; then\n    # Linux\n    sudo apt-get install -y maven\n  elif [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n    # Mac\n    brew install maven\n  else\n    echo \"Unsupported OS for Maven install: $OSTYPE\"\n    exit 1\n  fi\n\n\nsudo chmod -R 777 .\n\ntar -zxvf LYH-RAIN_SourceCodeCreation.tar.gz\ncd demo1\nmvn clean package\n\n# 指定目标目录为当前目录\ntarget_directory=\".\"\n\n# 在目标目录中查找名字以\"server\"结尾的.jar文件\nfind \"${target_directory}\" -type f -name \"demo1*.jar\" -print0 | while IFS= read -r -d '' file; do\n    # 输出包含目标文件的目录\n    directory=$(dirname \"${file}\")\n    echo \"目录: ${directory}\"\ndone\n# 获取当前目录\ncurrent_directory=$(pwd)\n\n# 打印当前目录\necho \"当前目录: ${current_directory}\"\nJAR_FILE=\"/home/admin/application/demo1/target/demo1-0.0.1-SNAPSHOT.jar\"\n\n# 检查是否有同名的 Java 进程在运行\nPID=$(jps -mlv | grep \"$JAR_FILE\" | awk '{print $1}')\n\nif [ -n \"$PID\" ]; then\n  echo \"Found running process with PID: $PID\"\n\n  # 发送关闭信号给程序\n  kill -9 $PID\n\n  # 等待一段时间，确保程序关闭\n  sleep 5\n\n  # 再次检查是否还有进程在运行\n  PID=$(jps -mlv | grep \"$JAR_FILE\" | awk '{print $1}')\n\n  if [ -n \"$PID\" ]; then\n    echo \"Failed to gracefully stop the process with PID: $PID\"\n    exit 1\n  else\n    echo \"Successfully stopped the process\"\n  fi\nfi\nsudo nohup java -jar /home/admin/application/boost.server/target/demo1-0.0.1-SNAPSHOT.jar > /dev/null 2>&1 &\n","SourceCodePath":".","CommandTimeout":3600,"ServiceType":"private","AllowedRegions":["cn-hangzhou","cn-shanghai","cn-beijing"],"ArtifactSourceType":"SourceCode","ImageId":"centos_7_9_x64_20G_alibase_20230613.vhd","RegionId":"cn-hangzhou","CustomParameters":[{"NoEcho":true,"Type":"String","AssociationProperty":"ALIYUN::ECS::Instance::Password","Label":"管理员密码","Name":"AdminPassword"}]}
